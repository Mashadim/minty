var data = [{
  "line": 2,
  "variables": {
    "two": 2
  }
}, {
  "line": 3,
  "variables": {
    "two": 2,
    "four": 2
  }
}, {
  "line": 8,
  "variables": {
    "two": 2,
    "four": 2,
    "i": 0
  }
}, {
  "line": 8,
  "variables": {
    "two": 2,
    "four": 2,
    "i": 1
  }
}, {
  "line": 8,
  "variables": {
    "two": 2,
    "four": 2,
    "i": 2
  }
}, {
  "line": 8,
  "variables": {
    "two": 2,
    "four": 2,
    "i": 3
  }
}, {
  "line": 8,
  "variables": {
    "two": 2,
    "four": 2,
    "i": 4
  }
}, {
  "line": 8,
  "variables": {
    "two": 2,
    "four": 2,
    "i": 5
  }
}, {
  "line": 8,
  "variables": {
    "two": 2,
    "four": 2,
    "i": 6
  }
}, {
  "line": 8,
  "variables": {
    "two": 2,
    "four": 2,
    "i": 7
  }
}, {
  "line": 8,
  "variables": {
    "two": 2,
    "four": 2,
    "i": 8
  }
}, {
  "line": 8,
  "variables": {
    "two": 2,
    "four": 2,
    "i": 9
  }
}, {
  "line": 10,
  "variables": {
    "two": 2,
    "four": 2,
    "i": 10
  }
}, {
  "line": 12,
  "variables": {
    "two": 2,
    "four": 2,
    "i": 0
  }
}, {
  "line": 12,
  "variables": {
    "two": 2,
    "four": 2,
    "i": 1
  }
}, {
  "line": 12,
  "variables": {
    "two": 2,
    "four": 2,
    "i": 2
  }
}, {
  "line": 12,
  "variables": {
    "two": 2,
    "four": 2,
    "i": 3
  }
}, {
  "line": 12,
  "variables": {
    "two": 2,
    "four": 2,
    "i": 4
  }
}, {
  "line": 13,
  "variables": {
    "two": 2,
    "four": 2,
    "i": 5
  }
}, {
  "line": 23,
  "variables": {
    "two": 2,
    "four": 2,
    "i": 5
  }
}, {
  "line": 15,
  "variables": {
    "two": 2,
    "four": 2,
    "i": 5,
    "a": 1,
    "b": 2,
    "c": 3
  }
}, {
  "line": 16,
  "variables": {
    "two": 2,
    "four": 2,
    "i": 5,
    "a": 1,
    "b": 2,
    "c": 3
  }
}, {
  "line": 20,
  "variables": {
    "two": 2,
    "four": 2,
    "i": 5,
    "a": 1,
    "b": 2,
    "c": 3
  }
}, {
  "line": 17,
  "variables": {
    "two": 2,
    "four": 2,
    "i": 5,
    "a": 1,
    "b": 2,
    "c": 3,
    "d": 4,
    "e": 5,
    "f": 6
  }
}, {
  "line": 18,
  "variables": {
    "two": 2,
    "four": 2,
    "i": 5,
    "a": 1,
    "b": 2,
    "c": 3,
    "d": 4,
    "e": 5,
    "f": 6
  }
}, {
  "line": 19,
  "variables": {
    "two": 2,
    "four": 2,
    "i": 5,
    "a": 1,
    "b": 2,
    "c": 3,
    "d": 4,
    "e": 5,
    "f": 6,
    "bus": "slow"
  }
}, {
  "line": 21,
  "variables": {
    "two": 2,
    "four": 2,
    "i": 5,
    "a": 1,
    "b": 2,
    "c": 3
  }
}, {
  "line": 22,
  "variables": {
    "two": 2,
    "four": 2,
    "i": 5,
    "a": 1,
    "b": 2,
    "c": 3,
    "car": "toyota"
  }
}, {
  "line": 26,
  "variables": {
    "two": 2,
    "four": 2,
    "i": 5
  }
}, {
  "line": 29,
  "variables": {
    "two": 2,
    "four": 2,
    "i": 5,
    "val": 1
  }
}, {
  "line": 30,
  "variables": {
    "two": 2,
    "four": 2,
    "i": 5,
    "val": 1
  }
}, {
  "line": 29,
  "variables": {
    "two": 2,
    "four": 2,
    "i": 5,
    "val": 2
  }
}, {
  "line": 30,
  "variables": {
    "two": 2,
    "four": 2,
    "i": 5,
    "val": 2
  }
}, {
  "line": 29,
  "variables": {
    "two": 2,
    "four": 2,
    "i": 5,
    "val": 3
  }
}, {
  "line": 30,
  "variables": {
    "two": 2,
    "four": 2,
    "i": 5,
    "val": 3
  }
}, {
  "line": 31,
  "variables": {
    "two": 2,
    "four": 2,
    "i": 5
  }
}, {
  "line": 33,
  "variables": {
    "two": 2,
    "four": 2,
    "i": 0,
    "val": 1
  }
}, {
  "line": 34,
  "variables": {
    "two": 2,
    "four": 2,
    "i": 0,
    "val": 1
  }
}, {
  "line": 33,
  "variables": {
    "two": 2,
    "four": 2,
    "i": 1,
    "val": 2
  }
}, {
  "line": 34,
  "variables": {
    "two": 2,
    "four": 2,
    "i": 1,
    "val": 2
  }
}, {
  "line": 33,
  "variables": {
    "two": 2,
    "four": 2,
    "i": 2,
    "val": 3
  }
}, {
  "line": 34,
  "variables": {
    "two": 2,
    "four": 2,
    "i": 2,
    "val": 3
  }
}, {
  "line": 35,
  "variables": {
    "two": 2,
    "four": 2,
    "i": 5
  }
}, {
  "line": 39,
  "variables": {
    "two": 2,
    "four": 2,
    "i": 5,
    "checkThis": "function () {\n  console.log('hello there my friend');\n}"
  }
}, {
  "line": 45,
  "variables": {
    "two": 2,
    "four": 2,
    "i": 5,
    "checkThis": "function () {\n  console.log('hello there my friend');\n}",
    "what": "what"
  }
}, {
  "line": 47,
  "variables": {
    "two": 2,
    "four": 2,
    "i": 5,
    "checkThis": "function () {\n  console.log('hello there my friend');\n}",
    "what": "what",
    "test": "hello"
  }
}, {
  "line": 49,
  "variables": {
    "two": 2,
    "four": 2,
    "i": 5,
    "checkThis": "function () {\n  console.log('hello there my friend');\n}",
    "what": "what",
    "test": "hello buddy"
  }
}, {
  "line": 51,
  "variables": {
    "two": 2,
    "four": 2,
    "i": 5,
    "checkThis": "function () {\n  console.log('hello there my friend');\n}",
    "what": "what",
    "test": "hello buddy",
    "hello": "hi"
  }
}];
console.log(data);





$(document).ready(() => {

  var variableWatch = data[data.length - 1];
  // appending variable names to the DOM - all their values start out as undefined
  for (var key in variableWatch.variables) {
    $('tbody').append(`<tr id=${key}></tr>`);
    $(`#${key}`).append(`<td>${key}</td>`).append(`<td id=${key +'val'}>undefined</td>`);
  }
  $('#back').prop('disabled', true);

  var index = [],
      indexCounter = -1,
      dataLength = data.length,
      watchedVariablesObj,
      oldLine,
      newLine;

  $('#forward').click((e) => {
    if (indexCounter < dataLength - 1) {
      oldLine = indexCounter;
      indexCounter++;
      newLine = indexCounter;
      index.push(indexCounter);
      $('#back').prop('disabled', false);
    }
    if (indexCounter === dataLength - 1)
      $('#forward').prop('disabled', true);

    //updating the variable values
    watchedVariables = data[indexCounter].variables;
    if (data[indexCounter]) {
      // console.log('indexCounter', indexCounter, 'variables:', data[indexCounter])
      // console.log('indexCounter', indexCounter, 'old line:', data[oldLine].line, 'new line:', data[newLine].line, 'variables:', watchedVariables);
      console.log('indexCounter', indexCounter, 'new line:', data[newLine].line, 'variables:', watchedVariables);
      if (oldLine >= 0) removeLineIndicator(data[oldLine].line + 1);
      placeLineIndicator(data[newLine].line + 1);
      for (var key in watchedVariables) {
        $(`#${key + 'val'}`).remove();
        $(`#${key}`).append(`<td id="${key + 'val'}" class="variables">${watchedVariables[key]}</td>`);
      }
    }
  });

  $('#back').click(() => {
    var watchedVariablesObj,
        declaredVariables = Object.keys(data[data.length - 1].variables),
        decVar;
    if (indexCounter > -1) {
      removeLineIndicator(data[indexCounter].line + 1);
      indexCounter--;
      placeLineIndicator(data[indexCounter].line + 1);
      index.pop();
      $('#forward').prop('disabled', false);
    }
    //making sure all the values revert back to undefined when the user clicks back all the way to the beginning
    if (indexCounter === -1) {
      console.log('inside if', indexCounter)
      $('.variables').each((i, elem) => {
        console.log('in each', elem)
        if ($(elem).text() !== 'undefined')
          $(elem).text('undefined');
      });
      $('#back').prop('disabled', true);
      return;
    }

    //when user clicks back, this will update the DOM with new values
    watchedVariables = data[indexCounter].variables;
    if (data[indexCounter]) {
      console.log('indexCounter', indexCounter, 'old line:', data[oldLine].line, 'new line:', data[newLine].line, 'variables:', watchedVariables);
      for (var key in watchedVariables) {
        $(`#${key + 'val'}`).remove();
        $(`#${key}`).append(`<td id="${key + 'val'}" class="variables">${watchedVariables[key]}</td>`);
      }
    }

    // if user is analyzing a line of code and some of the variables are no longer on the watch list, those variables will get the value undefined
    for (var i = 0, n = declaredVariables.length; i < n; i ++) {
      declaredVar = declaredVariables[i]
      if (!watchedVariables[declaredVar]) {
        $(`#${declaredVar + 'val'}`).remove();
        $(`#${declaredVar}`).append(`<td id="${declaredVar + 'val'}">undefined</td>`);
      }
    }
  });
});
