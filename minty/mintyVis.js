var data = {"entry":"test.js","log":[{"file":"test.js","line":2,"variables":{"one":"undefined","two":2,"three":1}},{"file":"test.js","line":3,"variables":{"one":"undefined","two":2,"three":1,"four":2,"five":"undefined"}},{"file":"test.js","line":4,"variables":{"one":"undefined","two":2,"three":1,"four":2,"five":"undefined","seven":{"a":1,"b":2}}},{"file":"test.js","line":5,"variables":{"one":"undefined","two":2,"three":1,"four":2,"five":"undefined","seven":{"a":1,"b":2},"six":[1,2,3,4]}},{"file":"test.js","line":9,"variables":{"one":"undefined","two":2,"three":1,"four":2,"five":"undefined","seven":{"a":1,"b":2},"six":[1,2,3,4],"i":0}},{"file":"test.js","line":9,"variables":{"one":"undefined","two":2,"three":1,"four":2,"five":"undefined","seven":{"a":1,"b":2},"six":[1,2,3,4],"i":1}},{"file":"test.js","line":9,"variables":{"one":"undefined","two":2,"three":1,"four":2,"five":"undefined","seven":{"a":1,"b":2},"six":[1,2,3,4],"i":2}},{"file":"test.js","line":9,"variables":{"one":"undefined","two":2,"three":1,"four":2,"five":"undefined","seven":{"a":1,"b":2},"six":[1,2,3,4],"i":3}},{"file":"test.js","line":9,"variables":{"one":"undefined","two":2,"three":1,"four":2,"five":"undefined","seven":{"a":1,"b":2},"six":[1,2,3,4],"i":4}},{"file":"test.js","line":9,"variables":{"one":"undefined","two":2,"three":1,"four":2,"five":"undefined","seven":{"a":1,"b":2},"six":[1,2,3,4],"i":5}},{"file":"test.js","line":9,"variables":{"one":"undefined","two":2,"three":1,"four":2,"five":"undefined","seven":{"a":1,"b":2},"six":[1,2,3,4],"i":6}},{"file":"test.js","line":9,"variables":{"one":"undefined","two":2,"three":1,"four":2,"five":"undefined","seven":{"a":1,"b":2},"six":[1,2,3,4],"i":7}},{"file":"test.js","line":9,"variables":{"one":"undefined","two":2,"three":1,"four":2,"five":"undefined","seven":{"a":1,"b":2},"six":[1,2,3,4],"i":8}},{"file":"test.js","line":9,"variables":{"one":"undefined","two":2,"three":1,"four":2,"five":"undefined","seven":{"a":1,"b":2},"six":[1,2,3,4],"i":9}},{"file":"test.js","line":13,"variables":{"one":"undefined","two":2,"three":1,"four":2,"five":"undefined","seven":{"a":1,"b":2},"six":[1,2,3,4],"j":0}},{"file":"test.js","line":13,"variables":{"one":"undefined","two":2,"three":1,"four":2,"five":"undefined","seven":{"a":1,"b":2},"six":[1,2,3,4],"j":1}},{"file":"test.js","line":13,"variables":{"one":"undefined","two":2,"three":1,"four":2,"five":"undefined","seven":{"a":1,"b":2},"six":[1,2,3,4],"j":2}},{"file":"test.js","line":13,"variables":{"one":"undefined","two":2,"three":1,"four":2,"five":"undefined","seven":{"a":1,"b":2},"six":[1,2,3,4],"j":3}},{"file":"test.js","line":13,"variables":{"one":"undefined","two":2,"three":1,"four":2,"five":"undefined","seven":{"a":1,"b":2},"six":[1,2,3,4],"j":4}},{"file":"test.js","line":16,"variables":{"one":"undefined","two":2,"three":1,"four":2,"five":"undefined","seven":{"a":1,"b":2},"six":[1,2,3,4],"a":1,"b":2,"c":3}},{"file":"test.js","line":17,"variables":{"one":"undefined","two":2,"three":1,"four":2,"five":"undefined","seven":{"a":1,"b":2},"six":[1,2,3,4],"a":1,"b":2,"c":3}},{"file":"test.js","line":18,"variables":{"one":"undefined","two":2,"three":1,"four":2,"five":"undefined","seven":{"a":1,"b":2},"six":[1,2,3,4],"a":1,"b":2,"c":3,"d":4,"e":5,"f":6}},{"file":"test.js","line":19,"variables":{"one":"undefined","two":2,"three":1,"four":2,"five":"undefined","seven":{"a":1,"b":2},"six":[1,2,3,4],"a":1,"b":2,"c":3,"d":4,"e":5,"f":6}},{"file":"test.js","line":20,"variables":{"one":"undefined","two":2,"three":1,"four":2,"five":"undefined","seven":{"a":1,"b":2},"six":[1,2,3,4],"a":1,"b":2,"c":3,"d":4,"e":5,"f":6,"bus":"slow"}},{"file":"test.js","line":22,"variables":{"one":"undefined","two":2,"three":1,"four":2,"five":"undefined","seven":{"a":1,"b":2},"six":[1,2,3,4],"a":1,"b":2,"c":3}},{"file":"test.js","line":23,"variables":{"one":"undefined","two":2,"three":1,"four":2,"five":"undefined","seven":{"a":1,"b":2},"six":[1,2,3,4],"a":1,"b":2,"c":3,"car":"toyota"}},{"file":"test.js","line":27,"variables":{"one":"undefined","two":2,"three":1,"four":2,"five":"undefined","seven":{"a":1,"b":2},"six":[1,2,3,4]}},{"file":"test.js","line":30,"variables":{"one":"undefined","two":2,"three":1,"four":2,"five":"undefined","seven":{"a":1,"b":2},"six":[1,2,3,4],"val":1}},{"file":"test.js","line":31,"variables":{"one":"undefined","two":2,"three":1,"four":2,"five":"undefined","seven":{"a":1,"b":2},"six":[1,2,3,4],"val":1}},{"file":"test.js","line":30,"variables":{"one":"undefined","two":2,"three":1,"four":2,"five":"undefined","seven":{"a":1,"b":2},"six":[1,2,3,4],"val":2}},{"file":"test.js","line":31,"variables":{"one":"undefined","two":2,"three":1,"four":2,"five":"undefined","seven":{"a":1,"b":2},"six":[1,2,3,4],"val":2}},{"file":"test.js","line":30,"variables":{"one":"undefined","two":2,"three":1,"four":2,"five":"undefined","seven":{"a":1,"b":2},"six":[1,2,3,4],"val":3}},{"file":"test.js","line":31,"variables":{"one":"undefined","two":2,"three":1,"four":2,"five":"undefined","seven":{"a":1,"b":2},"six":[1,2,3,4],"val":3}},{"file":"test.js","line":34,"variables":{"one":"undefined","two":2,"three":1,"four":2,"five":"undefined","seven":{"a":1,"b":2},"six":[1,2,3,4],"val":1,"i":0}},{"file":"test.js","line":35,"variables":{"one":"undefined","two":2,"three":1,"four":2,"five":"undefined","seven":{"a":1,"b":2},"six":[1,2,3,4],"val":1,"i":0}},{"file":"test.js","line":34,"variables":{"one":"undefined","two":2,"three":1,"four":2,"five":"undefined","seven":{"a":1,"b":2},"six":[1,2,3,4],"val":2,"i":1}},{"file":"test.js","line":35,"variables":{"one":"undefined","two":2,"three":1,"four":2,"five":"undefined","seven":{"a":1,"b":2},"six":[1,2,3,4],"val":2,"i":1}},{"file":"test.js","line":34,"variables":{"one":"undefined","two":2,"three":1,"four":2,"five":"undefined","seven":{"a":1,"b":2},"six":[1,2,3,4],"val":3,"i":2}},{"file":"test.js","line":35,"variables":{"one":"undefined","two":2,"three":1,"four":2,"five":"undefined","seven":{"a":1,"b":2},"six":[1,2,3,4],"val":3,"i":2}},{"file":"test.js","line":43,"variables":{"one":"undefined","two":2,"three":1,"four":2,"five":"undefined","seven":{"a":1,"b":2},"six":[1,2,3,4],"checkThis":"function () {\n  console.log('hello there my friend');\n}","k":10}},{"file":"test.js","line":45,"variables":{"one":"undefined","two":2,"three":1,"four":2,"five":"undefined","seven":{"a":1,"b":2},"six":[1,2,3,4],"checkThis":"function () {\n  console.log('hello there my friend');\n}","k":10}},{"file":"test.js","line":46,"variables":{"one":"undefined","two":2,"three":1,"four":2,"five":"undefined","seven":{"a":1,"b":2},"six":[1,2,3,4],"checkThis":"function () {\n  console.log('hello there my friend');\n}","k":10}},{"file":"test.js","line":47,"variables":{"one":"undefined","two":2,"three":1,"four":2,"five":"undefined","seven":{"a":1,"b":2},"six":[1,2,3,4],"checkThis":"function () {\n  console.log('hello there my friend');\n}","k":9}},{"file":"test.js","line":45,"variables":{"one":"undefined","two":2,"three":1,"four":2,"five":"undefined","seven":{"a":1,"b":2},"six":[1,2,3,4],"checkThis":"function () {\n  console.log('hello there my friend');\n}","k":9}},{"file":"test.js","line":46,"variables":{"one":"undefined","two":2,"three":1,"four":2,"five":"undefined","seven":{"a":1,"b":2},"six":[1,2,3,4],"checkThis":"function () {\n  console.log('hello there my friend');\n}","k":9}},{"file":"test.js","line":47,"variables":{"one":"undefined","two":2,"three":1,"four":2,"five":"undefined","seven":{"a":1,"b":2},"six":[1,2,3,4],"checkThis":"function () {\n  console.log('hello there my friend');\n}","k":8}},{"file":"test.js","line":45,"variables":{"one":"undefined","two":2,"three":1,"four":2,"five":"undefined","seven":{"a":1,"b":2},"six":[1,2,3,4],"checkThis":"function () {\n  console.log('hello there my friend');\n}","k":8}},{"file":"test.js","line":46,"variables":{"one":"undefined","two":2,"three":1,"four":2,"five":"undefined","seven":{"a":1,"b":2},"six":[1,2,3,4],"checkThis":"function () {\n  console.log('hello there my friend');\n}","k":8}},{"file":"test.js","line":47,"variables":{"one":"undefined","two":2,"three":1,"four":2,"five":"undefined","seven":{"a":1,"b":2},"six":[1,2,3,4],"checkThis":"function () {\n  console.log('hello there my friend');\n}","k":7}},{"file":"test.js","line":45,"variables":{"one":"undefined","two":2,"three":1,"four":2,"five":"undefined","seven":{"a":1,"b":2},"six":[1,2,3,4],"checkThis":"function () {\n  console.log('hello there my friend');\n}","k":7}},{"file":"test.js","line":46,"variables":{"one":"undefined","two":2,"three":1,"four":2,"five":"undefined","seven":{"a":1,"b":2},"six":[1,2,3,4],"checkThis":"function () {\n  console.log('hello there my friend');\n}","k":7}},{"file":"test.js","line":47,"variables":{"one":"undefined","two":2,"three":1,"four":2,"five":"undefined","seven":{"a":1,"b":2},"six":[1,2,3,4],"checkThis":"function () {\n  console.log('hello there my friend');\n}","k":6}},{"file":"test.js","line":45,"variables":{"one":"undefined","two":2,"three":1,"four":2,"five":"undefined","seven":{"a":1,"b":2},"six":[1,2,3,4],"checkThis":"function () {\n  console.log('hello there my friend');\n}","k":6}},{"file":"test.js","line":46,"variables":{"one":"undefined","two":2,"three":1,"four":2,"five":"undefined","seven":{"a":1,"b":2},"six":[1,2,3,4],"checkThis":"function () {\n  console.log('hello there my friend');\n}","k":6}},{"file":"test.js","line":47,"variables":{"one":"undefined","two":2,"three":1,"four":2,"five":"undefined","seven":{"a":1,"b":2},"six":[1,2,3,4],"checkThis":"function () {\n  console.log('hello there my friend');\n}","k":5}},{"file":"test.js","line":45,"variables":{"one":"undefined","two":2,"three":1,"four":2,"five":"undefined","seven":{"a":1,"b":2},"six":[1,2,3,4],"checkThis":"function () {\n  console.log('hello there my friend');\n}","k":5}},{"file":"test.js","line":46,"variables":{"one":"undefined","two":2,"three":1,"four":2,"five":"undefined","seven":{"a":1,"b":2},"six":[1,2,3,4],"checkThis":"function () {\n  console.log('hello there my friend');\n}","k":5}},{"file":"test.js","line":47,"variables":{"one":"undefined","two":2,"three":1,"four":2,"five":"undefined","seven":{"a":1,"b":2},"six":[1,2,3,4],"checkThis":"function () {\n  console.log('hello there my friend');\n}","k":4}},{"file":"test.js","line":45,"variables":{"one":"undefined","two":2,"three":1,"four":2,"five":"undefined","seven":{"a":1,"b":2},"six":[1,2,3,4],"checkThis":"function () {\n  console.log('hello there my friend');\n}","k":4}},{"file":"test.js","line":46,"variables":{"one":"undefined","two":2,"three":1,"four":2,"five":"undefined","seven":{"a":1,"b":2},"six":[1,2,3,4],"checkThis":"function () {\n  console.log('hello there my friend');\n}","k":4}},{"file":"test.js","line":47,"variables":{"one":"undefined","two":2,"three":1,"four":2,"five":"undefined","seven":{"a":1,"b":2},"six":[1,2,3,4],"checkThis":"function () {\n  console.log('hello there my friend');\n}","k":3}},{"file":"test.js","line":56,"variables":{"one":"undefined","two":2,"three":1,"four":2,"five":"undefined","seven":{"a":1,"b":2},"six":[1,2,3,4],"checkThis":"function () {\n  console.log('hello there my friend');\n}","k":3,"what":"what"}},{"file":"test.js","line":58,"variables":{"one":"undefined","two":2,"three":1,"four":2,"five":"undefined","seven":{"a":1,"b":2},"six":[1,2,3,4],"checkThis":"function () {\n  console.log('hello there my friend');\n}","k":3,"what":"what"},"error":"that is not defined"}],"test.js":"\"use strict\";\n\nvar one, two = 2, three = 1;\nvar four = 2, five;\nvar seven = {a: 1, b: 2}\nvar six = [1,2,3,4];\n\n //what should we do if var test = 'shoot'\n\nfor(let i = 0; i < 10; i++) {\n\n}\n\nfor(var j = 0; j < 5; j++) {\n}\n\nfunction fn(a, b, c) {\n  console.log(a,b,c);\n  function fn2(d,e,f) {\n    console.log('what!');\n    var bus = 'slow';\n  }\n  fn2(4,5,6);\n  var car = 'toyota';\n}\n\n\nfn(1,2,3);\n\n\n[1,2,3].forEach(val => {\n  console.log(val);\n});\n\n[1,2,3].forEach((val, i) => {\n  console.log(val);\n});\n\nvar checkThis = function() {\n  console.log('hello there my friend');\n};\n\n\nvar k = 10;\n\nwhile(k !== 3) {\n  console.log(k);\n  k--\n}\n\n\n\n/*\n* here is another comment\n* with some stuff\n* shoot */\nlet what = 'what';\n\nconsole.log(that)\nvar test = \"hello\";\nvar wade = `wade`;\ntest += \" buddy\";\n\nconst hello = 'hi';\n"}




$(document).ready(() => {

  var indexCounter = -1,
      dataLength = data.log.length,
      watchedVariables,
      completeVariableList = data.log[dataLength - 1].variables,
      declaredVariables = Object.keys(completeVariableList),
      oldIndex,
      newIndex;

  // appending variable names to the DOM - all their values start out as undefined
  for (var key in completeVariableList) {
    $('tbody').append(`<tr id=${key}></tr>`);
    $(`#${key}`).append(`<td>${key}</td>`).append(`<td id=${key +'val'} class="variables">undefined</td>`);
  }


  disableBackFirstButtons(true);
  $('#step').text(`Step 0 of ${dataLength}`);
//
  $('#forward').click((e) => {

    if (indexCounter < dataLength - 1) {
      oldIndex = indexCounter;
      indexCounter++;
      newIndex = indexCounter;
      console.log()
      moveLineIndicator(newIndex, oldIndex, data.log);

      disableBackFirstButtons(false);
      $('#step').text(`Step ${indexCounter+1} of ${dataLength}`);

    }


    if (indexCounter === dataLength - 1)
      disableForwardLastButtons(true);

    //updating the variable values
    watchedVariables = data.log[indexCounter].variables;
    if (data[indexCounter]) {
      // console.log('indexCounter', indexCounter, 'variables:', data[indexCounter]);
      for (var key in watchedVariables) {
        updateVariables(key, watchedVariables);
      }
    }
  });

  $('#back').click(() => {

    var watchedVariables,
        decVar;

    if (indexCounter > -1) {
      oldIndex = indexCounter;
      indexCounter--;
      newIndex = indexCounter;
      moveLineIndicator(newIndex, oldIndex, data.log);
      disableForwardLastButtons(false);
      $('#step').text(`Step ${indexCounter + 1} of ${dataLength}`);

    }
    //make all values revert back to undefined when the user clicks back all the way to the beginning with the back button
    if (indexCounter === -1) {
      makeValuesUndefined();
      return;
    }

    //when user clicks back, this will update the DOM with new values
    watchedVariables = data.log[indexCounter].variables;
    if (data[indexCounter]) {
      console.log('indexCounter', indexCounter, 'old line:', data[oldIndex].line, 'new line:', data[newIndex].line, 'variables:', watchedVariables);
      for (var key in watchedVariables) {
        updateVariables(key, watchedVariabes);
      }
    }

    // if user is analyzing a line of code and some of the variables are no longer on the watch list, those variables will get the value undefined
    for (var i = 0, n = declaredVariables.length; i < n; i ++) {
      declaredVar = declaredVariables[i]
      if (!watchedVariables[declaredVar]) {
        if (watchedVariables[declaredVar] === 0) return;
        $(`#${declaredVar + 'val'}`).remove();
        $(`#${declaredVar}`).append(`<td id="${declaredVar + 'val'}" class="variables">undefined</td>`);
      }
    }
  });

//make all values revert back to undefined when the user clicks first
  $('#first').click(() => {
    if (indexCounter === dataLength - 1)
      disableForwardLastButtons(false);

    oldIndex = indexCounter;
    indexCounter = -1;
    newIndex = indexCounter;
    moveLineIndicator(newIndex, oldIndex, data.log);
    makeValuesUndefined();
    $('#step').text(`Step ${indexCounter + 1} of ${dataLength}`);
  });

  //display variables and their values from the last index of the data set
  $('#last').click(() => {
    var variable;
    if (indexCounter === -1)
      disableBackFirstButtons(false);

    oldIndex = indexCounter;
    indexCounter = dataLength - 1;
    newIndex = indexCounter;
    moveLineIndicator(newIndex, oldIndex, data.log);
    $('.variables').each((i, elem) => {
      variable = completeVariableList[declaredVariables[i]];
      $(elem).text(`${variable}`);
    });
    disableForwardLastButtons(true);
    $('#step').text(`Step ${indexCounter + 1} of ${dataLength}`);
  });

});

//updates variables when user clicks forward or back button
function updateVariables(key, watchedVariables) {
  $(`#${key + 'val'}`).remove();
  if (watchedVariables[key] instanceof Array) {
    $('#main-table').remove();
    $('body').append($('<table/>', {'id': `main-table`}));
    $('.array-values').remove();
    $(`#${key}`).append(`<td id="${key + 'val'}" class="variables"></td>`);
    handleArrays(key, watchedVariables[key]);
  } else
    $(`#${key}`).append(`<td id="${key + 'val'}" class="variables">${watchedVariables[key]}</td>`);
};


function handleArrays(key, array, index) {
  var counter = 0;

  function inner (key, array, index) {
    counter++;
    $('#main-table').append(
      $('<table/>', {'id': `array-table${counter}`}).append(
        $('<tbody/>').append(
          $('<tr/>', {'id' : `array-display${counter}`})
        )
      )
    );

    if (array.length === 0)
      $(`#array-display${counter}`).append('<td class="array-values">Empty Array</td>');

    $(array).each((i, elem) => {
      if (elem instanceof Array) {
        // inner(key, elem, counter);
        $(`#array-display${counter}`).append(`<td class="array-values"></td>`);
      }
      else $(`#array-display${counter}`).append(`<td class="array-values">${elem}</td>`);
    });
  }
  inner(key, array, index);
};

function disableForwardLastButtons(value) {
  $('#forward').prop('disabled', value);
  $('#last').prop('disabled', value);
};

function disableBackFirstButtons(value) {
  $('#back').prop('disabled', value);
  $('#first').prop('disabled', value);
};

function makeValuesUndefined() {
  $('.variables').each((i, elem) => {
    if ($(elem).text() !== 'undefined')
      $(elem).text('undefined');
  });
  disableBackFirstButtons(true)
};
